<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Simple Web App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    .hidden { display: none; }
    .error { color: red; }
    .dashboard { margin-top: 2em; }
    .file-list { margin-top: 1em; }
  </style>
</head>
<body>
  <!-- Registration Page -->
  <div id="registerPage">
    <h2>Register</h2>
    <form id="registerForm">
      <label>Username: <input type="text" id="regUsername" required></label><br>
      <label>Password: <input type="password" id="regPassword" required></label><br>
      <label>Role:
        <select id="regRole">
          <option value="user">User</option>
          <option value="admin">Admin</option>
        </select>
      </label><br>
      <button type="submit">Register</button>
    </form>
    <div class="error" id="registerError"></div>
    <p>Already have an account? <a href="#" onclick="showLogin()">Login here</a></p>
  </div>

  <!-- Login Page -->
  <div id="loginPage" class="hidden">
    <h2>Login</h2>
    <form id="loginForm">
      <label>Username: <input type="text" id="loginUsername" required></label><br>
      <label>Password: <input type="password" id="loginPassword" required></label><br>
      <button type="submit">Login</button>
    </form>
    <div class="error" id="loginError"></div>
    <p>Don't have an account? <a href="#" onclick="showRegister()">Register here</a></p>
  </div>

  <!-- User Dashboard -->
  <div id="userDashboard" class="hidden dashboard">
    <h2>User Dashboard</h2>
    <form id="uploadForm">
      <label>Upload PDF (max 5MB): <input type="file" id="pdfFile" accept="application/pdf" required></label>
      <button type="submit">Upload</button>
    </form>
    <div class="error" id="uploadError"></div>
    <div class="file-list">
      <h3>Your Uploaded Files</h3>
      <ul id="userFiles"></ul>
    </div>
    <button onclick="logout()">Logout</button>
  </div>

  <!-- Admin Dashboard -->
  <div id="adminDashboard" class="hidden dashboard">
    <h2>Admin Dashboard</h2>
    <div class="file-list">
      <h3>All Uploaded Files</h3>
      <ul id="adminFiles"></ul>
    </div>
    <button onclick="logout()">Logout</button>
  </div>

  <script>
    // Simple in-memory "database"
    const users = [];
    const files = []; // {username, filename, data (base64), size}

    // Password hashing (SHA-256, not for production)
    async function hashPassword(password) {
      const encoder = new TextEncoder();
      const data = encoder.encode(password);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    // Strong password policy: min 8 chars, upper, lower, number, special
    function isStrongPassword(pw) {
      return /[A-Z]/.test(pw) && /[a-z]/.test(pw) && /\d/.test(pw) && /[^A-Za-z0-9]/.test(pw) && pw.length >= 8;
    }

    // UI helpers
    function showRegister() {
      document.getElementById('registerPage').classList.remove('hidden');
      document.getElementById('loginPage').classList.add('hidden');
      document.getElementById('userDashboard').classList.add('hidden');
      document.getElementById('adminDashboard').classList.add('hidden');
    }
    function showLogin() {
      document.getElementById('registerPage').classList.add('hidden');
      document.getElementById('loginPage').classList.remove('hidden');
      document.getElementById('userDashboard').classList.add('hidden');
      document.getElementById('adminDashboard').classList.add('hidden');
    }
    function showUserDashboard() {
      document.getElementById('registerPage').classList.add('hidden');
      document.getElementById('loginPage').classList.add('hidden');
      document.getElementById('userDashboard').classList.remove('hidden');
      document.getElementById('adminDashboard').classList.add('hidden');
      loadUserFiles();
    }
    function showAdminDashboard() {
      document.getElementById('registerPage').classList.add('hidden');
      document.getElementById('loginPage').classList.add('hidden');
      document.getElementById('userDashboard').classList.add('hidden');
      document.getElementById('adminDashboard').classList.remove('hidden');
      loadAdminFiles();
    }

    // Registration
    document.getElementById('registerForm').onsubmit = async function(e) {
      e.preventDefault();
      const username = document.getElementById('regUsername').value.trim();
      const password = document.getElementById('regPassword').value;
      const role = document.getElementById('regRole').value;
      document.getElementById('registerError').textContent = '';

      if (!isStrongPassword(password)) {
        document.getElementById('registerError').textContent = 'Password must be at least 8 characters, include upper, lower, number, and special character.';
        return;
      }
      if (users.find(u => u.username === username)) {
        document.getElementById('registerError').textContent = 'Username already exists.';
        return;
      }
      const hashed = await hashPassword(password);
      users.push({ username, password: hashed, role });
      showLogin();
    };

    // Login
    let currentUser = null;
    document.getElementById('loginForm').onsubmit = async function(e) {
      e.preventDefault();
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;
      document.getElementById('loginError').textContent = '';
      const user = users.find(u => u.username === username);
      if (!user) {
        document.getElementById('loginError').textContent = 'Incorrect username or password.';
        return;
      }
      const hashed = await hashPassword(password);
      if (user.password !== hashed) {
        document.getElementById('loginError').textContent = 'Incorrect username or password.';
        return;
      }
      currentUser = user;
      if (user.role === 'admin') showAdminDashboard();
      else showUserDashboard();
    };

    // Logout
    function logout() {
      currentUser = null;
      showLogin();
    }

    // File Upload (User)
    document.getElementById('uploadForm').onsubmit = function(e) {
      e.preventDefault();
      document.getElementById('uploadError').textContent = '';
      const fileInput = document.getElementById('pdfFile');
      const file = fileInput.files[0];
      if (!file) return;
      if (file.type !== 'application/pdf') {
        document.getElementById('uploadError').textContent = 'Only PDF files allowed.';
        return;
      }
      if (file.size > 5 * 1024 * 1024) {
        document.getElementById('uploadError').textContent = 'File size exceeds 5MB.';
        return;
      }
      const reader = new FileReader();
      reader.onload = function() {
        files.push({
          username: currentUser.username,
          filename: file.name,
          data: reader.result,
          size: file.size
        });
        loadUserFiles();
      };
      reader.readAsDataURL(file);
      fileInput.value = '';
    };

    // Load user files
    function loadUserFiles() {
      const userFiles = files.filter(f => f.username === currentUser.username);
      const ul = document.getElementById('userFiles');
      ul.innerHTML = '';
      userFiles.forEach(f => {
        const li = document.createElement('li');
        const link = document.createElement('a');
        link.href = f.data;
        link.textContent = f.filename + ` (${(f.size/1024).toFixed(1)} KB)`;
        link.download = f.filename;
        li.appendChild(link);
        ul.appendChild(li);
      });
    }

    // Load admin files
    function loadAdminFiles() {
      const ul = document.getElementById('adminFiles');
      ul.innerHTML = '';
      files.forEach(f => {
        const li = document.createElement('li');
        li.textContent = `[${f.username}] `;
        const link = document.createElement('a');
        link.href = f.data;
        link.textContent = f.filename + ` (${(f.size/1024).toFixed(1)} KB)`;
        link.download = f.filename;
        li.appendChild(link);
        ul.appendChild(li);
      });
    }

    // Initial page
    showRegister();
  </script>
</body>